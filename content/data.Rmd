---
title: Data
description:
toc: true
featuredVideo:
featuredImage: images/data-cleaning.png
draft: false
---


[Picture source](https://excelkid.com/15-ways-to-clean-data-in-excel/) 



## Datasets
1. Academic Ranking of World Universities (ARWU, from Opendatasoft) 
2. US News College Rankings (from Kaggle) 
3. US and Liberal College from (from US News) 
4. International Student Leading Institutes (from Opendoors) 
5. Carnegie Classification Data
6. QS World and National Rankings (from Kaggle)
7. Selectivity (from College Transitions)
8. Enrollment of the 120 Largest Degree-granting College (from NCES)
9. City Population and Density 



### Academic Ranking of World Universities (ARWU, from Opendatasoft) 
**Link:** [Opendatasoft](https://public.opendatasoft.com/explore/dataset/shanghai-world-university-ranking/table/?sort=world_rank&refine.country=United+States)


Opendatasoft is a French company which develops tools for sharing and reusing the data of companies and public administrations. The ARWU data we were looking for is one of such datasets provided from Opendatasoft. For the sake of our project, we downloaded the ARWU ranking in 2018 (the most recent year available on Opendatasoft) in a .csv file, which contains 139 observations. The variables are University name, World rank, Work rank integer, National rank,and Total score with the Criteria indicators: Alumni, Award, HiCi, N&S, PUB, PCP. Note that we found this alternative data source because data is not directly downloadable from the official ARWU website.



### US News College Rankings (from Kaggle) 
**Link:** [Kaggle](https://www.kaggle.com/datasets/neelgajare/2022-usa-college-rankings-more)


This dataset is the US News rankings of the best American universities of undergraduate programs. US News is a recognized leader in college rankings. There are 392 American universities based on their undergraduate programs. We also downloaded it from kaggle. The variables contain College Name, Tuition, Enrollment Number. In this dataset, there are two universities with no tuition data when merging all datasets. Scholars created this dataset to study which colleges are best, and to compare tuitions and enrollment numbers in the US.



### US and Liberal College from (from US News) 
**Link:** [US News](https://www.usnews.com/best-colleges/rankings/national-universities/most-international)


This dataset is from USNews that describes 145 American universities in 2022 with top proportions of international students, which was collected for publishing consumer advice, rankings, and relevant analysis. USNews is a very sourceful website commonly used by students for collecting and comparing universities’ information. We were able to do web scraping and generate the csv file for the dataset. Essentially, this data has 145 rows with 3 columns with School name, location, and percentage of international students, sorted by descending percentage.



### International Student Leading Institutes (from Opendoors) 
**Link:** [Opendoors](https://opendoorsdata.org/data/international-students/leading-institutions/)


Opendoors has been regarded as the comprehensive information resource on international students and scholars in the United States and on US students studying abroad. The dataset shows the view of the leading institutions hosting international students in the United States with the institution name and the number of international students.



### Carnegie Classification Data
**Link:** [Carnegie Classification](https://carnegieclassifications.acenet.edu/classification_descriptions/basic.php)


The Carnegie Classification® is been the prominent framework that captures the institutional diversity in U.S. post secondary insitutions for over the past 45 years.  The Carnegie dataset contained over 50 different features, but we selectively chose the 8 features: University Name, City, State, Carnegie Basic Classification, Size and Setting Classification, Control of institution, Enrollment Profile Classification, Degree of urbanization.



### QS World and National Rankings (from Kaggle)
**Link:** [Kaggle](https://www.kaggle.com/datasets/padhmam/qs-world-university-rankings-2017-2022)


The source of this data set comes from the QS World University Rankings, which is the annual university rankings published by Quacquarelli Symonds, and is viewed as one of the three most-widely read university rankings in the world. We found it on kaggle and it can be downloaded through the website. Kaggle is a data modeling and data analysis platform. Companies and researchers can publish and analyze data on it. This dataset contains basic information of 1368 universities around the world and their rankings from 2017 to 2022. This dataset was created to study factors that affect university rankings, what makes a good university. For our project, we used data from the most recent year (i.e., 2022).



### Selectivity (from College Transitions)
**Link:** [College Transitions](https://www.collegetransitions.com/college-selectivity/)


The data is not downloadable but instead we copied and pasted the table to excel sheets from the website. There are four categories for selectivity: most selective, extreme selective, very selective, moderately selective. College Transitions is a team of college planning experts committed to guiding students and families through the application process.From the source in College Transitions website, we found the college selectivity matters for members of non-dominant class(no white, wealthy, and well-educated) earned significantly more than similarly qualified students with same background who attended less exclusive schools.



### Enrollment of the 120 Largest Degree-granting College (from NCES)
**Link:** [NCES Dataset](https://nces.ed.gov/programs/digest/d21/tables/dt21_312.10.asp)


The data is sourced from the National Center for Education Statistics (NCES), which is an essential component of the United States Department of Education's Institute of Education Sciences that publishes statistics on education and public school district finance information in the United States. This Enrollment Dataset has 120 college observations and 6 columns describing institution name, state, rank, control (public, private-nonprofit, private-profit), level (4 year, 2 year), and total enrollment size.



### City Population and Density
**Link:** [Governing Dataset](https://www.governing.com/archive/population-density-land-area-cities-map.html)


The dataset is not downloadable but they have all the data from on the website. Instead, we just copy and paste the data from the website to form a dataset. The data of the Governing website is originally from [U.S. Census Bureau](https://www.census.gov/), which is an official website from US government that measure america’ s people, place and economy. It includes City, Population Density (Persons/Square Mile), 2016 Population and Land Area (Square Miles) important variables.





## Data Cleaning


As described above, we gathered data from nine different sources. In this section, we outlined how we cleaned each data subset in preparation for joining, how we joined all data subsets together, and how we continued to tidy the joined full data set. The complete codes for data cleaning can be found in this [load_and_clean_data.R file](/load_and_clean_data.R). 



### Initial Cleaning


Our initial data cleaning for each data subset included loading each data set, checking for problems, as well as selecting, arranging, and renaming relevant variables. Here we presented one example:

<br>

```{r eval=FALSE}
# The arwu dataset
arwu2018 <- read_delim(here::here("dataset/arwu-usa-2018.csv"), 
                       delim = ";", 
                       escape_double = FALSE, 
                       trim_ws = TRUE)

problems(arwu2018)

arwu2018 <- arwu2018 %>% 
  select(University, `Total score`, `World rank`, `World rank integer`, `National rank`, `N&S`, `Hi Ci`, Alumni, Award, PUB, PCP) %>% 
  rename(university = University,
         total_score_arwu = `Total score`, 
         world_rank_cat_arwu = `World rank`, 
         world_rank_arwu = `World rank integer`, 
         national_rank_arwu = `National rank`, 
         n_s_arwu = `N&S`, 
         hi_ci_arwu = `Hi Ci`, 
         alumni_arwu = Alumni, 
         award_arwu = Award, 
         pub_arwu = PUB, 
         pcp_arwu = PCP)
```




### Joining eight out of nine data subsets, followed by some cleaning


For joining, we first did a full join of the seven out of nine data sets (excluding the Carnegie Classification data and population density data), which was then left joined with the Carnegie Classification data. 

<br>

```{r eval=FALSE}
full_data_leftjoinCarnegie <- arwu2018 %>% 
  full_join(kagglecolleges, by = "university") %>% 
  full_join(nat_lib_uscolleges, by = "university") %>% 
  full_join(opendoors_2021SY, by = "university") %>% 
  full_join(qs2022, by = "university") %>% 
  full_join(selectivity, by = "university") %>% 
  full_join(top120enrollment2020fall, by = "university") %>% 
  left_join(p1_carnegie, by = "university") 
```

<br>

For variables that had multiple columns due to coming from different data sources, such as city and state, we aggregated the information to one column. Below is an example.

<br>

```{r eval=FALSE}
## Only keep one city column (there are four after joining) 
full_data_leftjoinCarnegie1 <- full_data_leftjoinCarnegie %>% 
  filter(!is.na(university)) %>% 
  head(-4) %>% 
  relocate(university, city.x, city.y, city.x.x, city.y.y) %>%
  arrange(is.na(city.x)) %>% 
  mutate(city.x = ifelse(is.na(city.x), city.y, city.x)) %>% 
  mutate(city.x = ifelse(is.na(city.x), city.x.x, city.x)) %>% 
  mutate(city.x = ifelse(is.na(city.x), city.y.y, city.x)) %>% 
  arrange(is.na(city.x)) %>% 
  select(-city.y, -city.x.x, -city.y.y) %>% 
  rename(city = city.x) %>% 
```

<br>

Initially, The left joined data set had 961 observations, with each row representing a university. Our outcome of interest, international student population, had three datapoints: (1) the percentage in 2021 from US news, (2) the actual number in 2021 from opendoors, and (3) the actual number from 2022 from QS but downloaded from Kaggle. We further filtered the dataset to universities which had at least one datapoint out of these three, which resulted in 499 observations. We saved the updated dataset. 



### Some manually cleaning directly in the .csv file


There were two parts of manually cleaning directly in the csv file we exported at this point. Firstly, we realized that some universities had multiple observations due to inconsistency use from different sources. For example, Purdue University has three observations:

* “Purdue University” 
* “Purdue University–West Lafayette”
* “Purdue University - West Lafayette”

<br>

To solve this issue, we sorted by university name and manually de-duplicated the dataset.  More specifically, we identified those universities with multiple observations, filled the information to all observations, and then deleted the duplicate observations to only keep one row. This procedure resulted in 441 observations (reducing from 499 observations), each of which represent a unique university. 

<br>

Secondly, for the 27 universities which has data on university name and city but missing data on state, we manually entered their state information in preparation for later joining. After that, we imported the de-duplicated csv file (`full_data_leftjoinCarnegie1_dedup.csv`) back to R and proceeded to further data cleaning.



### Deeper cleaning with the de-duplicated dataset


This round of deeper cleaning focused on three main areas. First, we combined predictor variables that had multiple data points (such as private or public, 2-year vs 4-year). Second, given that we had two columns (from two sources) on number of international students (which is one of our outcome variables), we combined them by creating a new variable that takes the maximum value of the two original columns. Third, we left joined the dataset with the remaining US city population data, which included variables on the city population, city land area, and city population density in 2016. 

<br>


### Semi-manual cleaning again


Due to the sparse dataset, if we modeled using city related predictors, the combination of test and train dataset may shrink to 10 observations, which is not a meaningful experiment and robust result. For this reason, we further cleaned data by correcting the values of city, state, city population, and city population density, from sources such as the US Census Bureau, University pages, [World Population Review](https://worldpopulationreview.com/), and [City Data](http://www.city-data.com/). We filled the missing city-related data in a newly created csv file (`Modified_Data.csv`) and then merged it with the existing dataset.


<br>


```{r eval=FALSE}
modified_city <- read_csv(here::here('dataset/Modified_Data.csv'))

semi_clean_data_dup = subset(semi_clean_data_dup, select = -c(city,state, city_population_density,city_population ) )

semi_clean_data <- semi_clean_data_dup%>% mutate(city =modified_city$city, 
                                            state =modified_city$state,
                                            city_population_density =modified_city$city_population_density, 
                                            city_population =modified_city$city_population)
```


### Making categorical variables factors


Finally, we dealt with the categorical variables, including re-leveling and re-ordering. Below is an example.

<br>


```{r eval=FALSE}
# locale_carnegie
clean_data$locale_carnegie[clean_data$locale_carnegie == 11 | 
                          clean_data$locale_carnegie == 12 |
                          clean_data$locale_carnegie == 13 ] <- "city"

clean_data$locale_carnegie[clean_data$locale_carnegie == 21 | 
                          clean_data$locale_carnegie == 22 |
                          clean_data$locale_carnegie == 23 ] <- "suburb"

clean_data$locale_carnegie[clean_data$locale_carnegie == 31 | 
                          clean_data$locale_carnegie == 32 |
                          clean_data$locale_carnegie == 33 |
                          clean_data$locale_carnegie == 41 |
                          clean_data$locale_carnegie == 42 ] <- "town or rural"

locale_carnegie_levels <- c(
  "city",
  "suburb",
  "town or rural")

clean_data$locale_carnegie <- factor(clean_data$locale_carnegie, levels = locale_carnegie_levels)
```


### This is a codebook for our final dataset (`clean_data.RData`). 

The first column has the final set of 29 variables included in our dataset. The second column explains what each variable means. The third column presents possible levels for the variable.

<br>

```{r codebook, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
tabl <- "
| Variable Name                 | Description                                            | Levels                                      |
|-------------------------------|------------------------------------------------------  |---------------------------------------------|
| university                    | name of the institution                                |                                             |
| city                          | city                                                   |                                             |
| state                         | state                                                  |                                             |
| international_students_natlib | proportion of international students at the institution|                                             |
| international_students_max    | number of international students at the institution    |                                             |
| city_population_density       | city population density of 2016                        |                                             |
| city_population               | city population of 2016                                |                                             |
| city_land_area                | city land area (square miles) of 2016                  |                                             |
| locale_carnegie               | degree of urbanization (Urban-centric locale)          | three levels: city, suburb, town or rural   |
| tuition_kaggle                | out of state tuition (in dollars)                      |                                             |
| selectivity                   | selectivity                                            | four levels: most competitive, highly competitive plus, highly competitive, very competitive plus  |
| world_rank_cat_arwu           | intervals of world ranking from ARWU                   | eight levels: 1-20, 21-50, 51-100, 101-150, 151-200, 210-300, 301-400, 401-500      |
| world_rank_qs                 | world ranking from qs                                  | twelve levels: 1-20, 21-50, 51-100, 101-150, 151-200, 210-300, 301-400, 401-500, 501-600, 601-800, 801-1000, 1001-1200  |
| type1_all                     | public vs. private                                     | two levels: public, private                  |
| type2_carnegie                | year and size classification                           | four levels: four-year (large), four-year (median), four-year (small), two-year     |
| type3_natlib                  | national or liberal Arts institution                   | two levels: national, liberal Arts           |
| type4_carnegie                | 2021 Carnegie Basic Classification                     | five levels: Doctoral Universities, Master's Colleges & Universities, Baccalaureate Colleges, Special Focus Four-Year,  Associate's Colleges    |
| enrprofile2021_carnegie       |  enrollment profile classification                     | three levels: exclusively or very high undergraduate, majority undergraduate, exclusively or majority graduate             |
| size_qs                       | size of the university in terms of area                | four levels: S, M, L, XL                     |
| research_output_qs            | index of quality of research at the university         | two levels: median high, very high           |
| stu_facl_ratio_qs             | number of students assigned to per faculty             |                                              |
| award_arwu                    | score assigned by ARWU on staff of an institution winning Nobel Prizes and Fields Medals    |         |
| hi_ci_arwu                    | score assigned by ARWU on highly cited researchers at the institution                       |         |
| n_s_arwu                      | score assigned by ARWU on papers published in Nature and Science from the institution       |         |
| pub_arwu               | score assigned by ARWU on papers indexed in Science Citation Index-Expanded and Social Science Citation Index from the institution |     |
| alumni_arwu                   | score assigned by ARWU on alumni of an institution winning Nobel Prizes and Fields Medals   |         |
| pcp_arwu                      | score assigned by ARWU on  per capita academic performance of an institution                |         |
| enrollment_kaggle             | undergraduate student enrollment number                |                                              |
| enrollment_top120enrollment   | total student enrollment number                        |                                              |
"
cat(tabl) # output the table in a format good for HTML/PDF/docx conversion
```




